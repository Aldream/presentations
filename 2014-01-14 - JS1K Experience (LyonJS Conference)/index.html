<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>JS1K, Retour d'expérience (LyonJS Presentation)</title>

		<meta name="description" content="Présentation du concours JS1K, de quelques astuces JS, et de mon expérience lors de la session 2013.">
		<meta name="author" content="Benjamin Bill Planche">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.js-2.6.1/reveal.min.css">
		<link rel="stylesheet" href="../css/reveal.js-2.6.1/theme/sky.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="../css/reveal.js-2.6.1/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="../css/reveal.js-2.6.1/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>JS1K</h1>
					<h2>Retour d'expérience</h2>
					<p>
						<small>Par <a href="http://aldream.net">Benjamin (Bill) Planche</a> (git:<a href="http://github.com/Aldream">Aldream</a>)<br/>
						Slides dispo sur <a href="https://github.com/Aldream/presentations">Github</a></small>
					</p>

					<aside class="notes">
						Oh hey, these are some notes. They'll be hidden in your presentation, but you can see them if you open the speaker notes window (hit 's' on your keyboard).
					</aside>
				</section>

				<section>
					<section>
						<pre style="width: 800px; word-wrap: break-word;"><code style="font: 'Courier New'; word-wrap: break-word;">_='dgX=R=r2;Y=.6;JL=l=0&[TN,5,Z=9,h=8];(D9>l;){i=p*oO;dh/;(++l]i)(j=p;jv=	N@iP|0jP|0],w=i*p+j,l][w&&(i%2?*2++p]+/4:(v+	+oP:+	P:vh@Y-&6>]?6:;o=i=pir/}g;setInterval(m=-Zw=-KZz=Yx=KYb=J;J%290*Tg=[],); (j=1e4;jtw,k=@R-2*ri=l,lL/r+.5|0,p=h,hL/r%1,F=h>p,F=N*i+l]+(C(!Cv=F-X*z-3,Um,f=z*v+(I=m*U+w*t)*x,v=(v*x-z*I^H+H,I=(w*U-m*t^W+W,f&lt;p=v*2*W+I]p&f,p=],F-=t+(p-h*]-(1-h)**52,Style="hsla("+[p?25Q+bQ*4:7pA*3Q:FG(u=F-bA:5.2&lt;FA*t/5:6.05&lt;pAQ*2:6&lt;pA:1.6+*.8b*l*i/47*f/3J/13)*17G.6]+")",$I,v,t=u/50+3-T,t)));++J},16)down=0}up}moveZ*X/W,Y=Y/H)}NnX+=f.dE|-f.DE}$0,0,W=c.wV#WVO8,H=c.hB#HB-21W/function(f){Math.;onmousecos(+orandom()=[];	lO][u]-*F-F@d[wa.fill25@6&lt;=2),--;wheelLO1-X*f.client)+for||(d[u=T/87)g[+1])j%2?(v#=inner$Rect(&]=@*(A?tBeightCF?p:hEeltaYG"%",Ksin(L=kN=oO-1P/2Q/pVidth^)/f*';for(Y in $='^VQPONLKGECBA@&$#	')with(_.split($[Y]))_=join(pop());eval(_)</code></pre>
						<p>?</p>
					</section>
					<section>
						<h3>... et avec un peu plus de contexte ?</h3>
						<pre style="width: 800px; word-wrap: break-word;"><code style="font: 'Courier New'; font-size: 0.9em; word-wrap: break-word;">&lt;!doctype html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;title&gt;JS1k, 1k demo submission [ID]&lt;/title&gt;
		&lt;meta charset="utf-8" /&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;canvas id="c"&gt;&lt;/canvas&gt;
		&lt;script&gt;
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
		&lt;/script&gt;
		&lt;script&gt;
// start of submission //
_='dgX=R=r2;Y=.6;JL=l=0&[TN,5,Z=9,h=8];(D9&gt;l;){i=p*oO;dh/;(++l]i)(j=p;jv=	N@iP|0jP|0],w=i*p+j,l][w&&(i%2?*2++p]+/4:(v+	+oP:+	P:vh@Y-&6&gt;]?6:;o=i=pir/}g;setInterval(m=-Zw=-KZz=Yx=KYb=J;J%290*Tg=[],); (j=1e4;jtw,k=@R-2*ri=l,lL/r+.5|0,p=h,hL/r%1,F=h&gt;p,F=N*i+l]+(C(!Cv=F-X*z-3,Um,f=z*v+(I=m*U+w*t)*x,v=(v*x-z*I^H+H,I=(w*U-m*t^W+W,f&lt;p=v*2*W+I]p&f,p=],F-=t+(p-h*]-(1-h)**52,Style="hsla("+[p?25Q+bQ*4:7pA*3Q:FG(u=F-bA:5.2&lt;FA*t/5:6.05&lt;pAQ*2:6&lt;pA:1.6+*.8b*l*i/47*f/3J/13)*17G.6]+")",$I,v,t=u/50+3-T,t)));++J},16)down=0}up}moveZ*X/W,Y=Y/H)}NnX+=f.dE|-f.DE}$0,0,W=c.wV#WVO8,H=c.hB#HB-21W/function(f){Math.;onmousecos(+orandom()=[];	lO][u]-*F-F@d[wa.fill25@6&lt;=2),--;wheelLO1-X*f.client)+for||(d[u=T/87)g[+1])j%2?(v#=inner$Rect(&]=@*(A?tBeightCF?p:hEeltaYG"%",Ksin(L=kN=oO-1P/2Q/pVidth^)/f*';for(Y in $='^VQPONLKGECBA@&$#	')with(_.split($[Y]))_=join(pop());eval(_)
// end of submission //
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre>
						<p> ... ?</p>
					</section>
					<section>
						<pre style="width: 800px; word-wrap: break-word;"><code style="font: 'Courier New'; word-wrap: break-word;">
Ce programme Javascript permet de générer procéduralement des paysages. Ces paysages doivent contenir un relief assez montagneux, ainsi qu'une étendue d'eau. L'utilisateur doit pouvoir se déplacer dans la scène : il peut naviguer autour du paysage en maintenant le clic gauche de la souris et en déplaçant celle-ci, ou s'approcher / s'éloigner à l'aide de la molette. Le paysage se génère continuellement, par ajouts de petites tâches de couleur (plus grosses lors des déplacements pour obtenir plus rapidement un aperçu). A chaque chargement de la page, le contenu doit être différent (génération pseudo-aléatoire). La scène doit être suffisamment détaillée pour donner une impression de réalisme et d'étendue. Dans la même optique, la notion d'illumination doit être simulée, en obscurcissant les zones adéquates. Afin de correspondre au thème printanier du concours, une notion de défilement du temps doit être exprimée. On donnera donc l'impression du passage des saisons grâce à l...
						</code></pre>
					</section>
					
					
					<section>
						<h2>Essence du concours JS1K :</h2>
						<p>Faire beaucoup avec peu</p>
						<p>Code minimaliste / immonde &rarr; Programme cool</p>
					</section>
				</section>

				<section>
					<section>
						<h2>Avertissements !</h2>
					</section>
					
					<section>
						<p>Le JS présenté ici n'est pas conforme W3C.</p>
					</section>
					
					<section>
						<p>A ne pas reproduire en entreprise.</p>
					</section>
					
					<section>
						<p>Peut entrainer TOC, insomnie et troubles de l'attention.</p>
						<p>Tenir hors de la portée et de la vue des programmeurs juniors.</p>
						<p>Ne pas dépasser la posologie conseillée.</p>
						<p>En cas d'effets indésirables, contactez votre lead-developer.</p>
					</section>
				</section>

				<section>
					<section>
						<h1>JS1K</h1>
					</section>
					
					<section>
						<a href="http://js1k.com" title="JS1K"><img src="img/js1k.png" alt="JS1K logo" /></a>
					</section>
					
					<section>
						<h2>Règlement</h2>
						
						<ul>
							<li class="fragment">Javascript, intégré au template html fourni</li>
							<li class="fragment">1024 octets max</li>
							<li class="fragment">Pas de ressources externes (lib, img, api, ...)</li>
							<li class="fragment">Cross-browser (récents)</li>
							<li class="fragment">Doit simplement fonctionner (au diable les best practices)</li>
						</ul>
					</section>
					
					<section>
						<h2>Template (shim)</h2>
						<pre style="width: 800px; word-wrap: break-word;"><code style="font: 'Courier New'; font-size: 0.8em; line-height: 90%; word-wrap: break-word;">&lt;!doctype html&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;title&gt;JS1k, 1k demo submission [ID]&lt;/title&gt;
		&lt;meta charset="utf-8" /&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;canvas id="c"&gt;&lt;/canvas&gt;
		&lt;script&gt;
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit
		&lt;/script&gt;
		&lt;script&gt;
// start of submission //
SCRIPT
// end of submission //
		&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;</code></pre>
						
					</section>
				</section>

				<section>
					<section>
						<h1>Mon Histoire</h1>
					</section>
					
					<section>
						<h2>Qui suis-je ?</h2>
					</section>
					
					<section>
						<h3>Benjamin (Bill) Planche, aka Aldream</h3>
						<ul>
							<li>Etudiant INSA-Lyon</li>
							<li>Spécialités : Web, AI & CG</li>
						</ul>
					</section>
					
					<section>
						<h3>Contexte</h3>
						<ul>
							<li>Fan de JS1K sans jamais participer auparavant</li>
							<li>En année de césure quand JS1K 2013 a été annoncé</li>
							<li>Avais déjà tenté de traduire ce projet Matlab en JS</li>
						</ul>
					</section>
					
					<section>
						<h2>Elaboration</h2>
					</section>
					
					<section>
						<h3>Première Tentative</h3>
						<h4>ou comment je perdis 2 semaines et toute confiance</h4>
						<p class="fragment">Tenter de compresser un script JS codé auparavant</p>
					</section>
					
					<section>
						<h3>Pourquoi ce fut une erreur ?</h3>
						<ul>
							<li class="fragment">Buggé de base, mal structuré (erreurs de jeunesse...)</li>
							<li class="fragment">ET SURTOUT, pas adapté aux nouvelles contraintes</li>
						</ul>
					</section>
					
					<section>
						<h3>Deuxième Tentative</h3>
						<h4>Partir de la Base</h4>
						<ul>
							<li class="fragment">Algo de visualisation 3D</li>
							<li class="fragment">Algo de génération procédurale</li>
						</ul>
					</section>
					
					<section>
						<p> XXXX TODO: Présenter les maths derrière la démo ??? XXX </p>
					</section>
				</section>

				<section>
					<section>
						<h1>Compression</h1>
					</section>
					
					<section>
						<h2>Comment atteindre 1ko ?</h2>
						<ol>
							<li class="fragment">Jouer sur la syntaxe JS</li>
							<li class="fragment">Faire bon usage des Maths</li>
							<li class="fragment">Utiliser des outils de minification/compression</li>
							<li class="fragment">Supprimer des fonctionnalités si nécéssaire</li>
							<li class="fragment">Répéter jusqu'à satisfaction</li>
						</ol>
					</section>
				</section>

				<section>
					<section>
						<h2>Syntaxe JS</h2>
						<p>Bible : <a href="">"Byte-saving Techniques"</a>,<br/>	wiki de la communauté <a href="http://www.140byt.es">140bytes</a></p>
					</section>
					
					<section>
						<h3>Variables</h3>
						<ul>
							<li>
								<p>Adieu <code>var</code></p>
								<pre><code>var a=0; var b=0; // avant
a=b=0   	         // après</code></pre>
							</li>
							<li>
								<p>(ré)utiliser les paramètres de fonctions</p>
								<pre><code>function(a){var b=1;...} // avant
function(a,b){b=1;...}   // après</code></pre>
							</li>
							<li>
								<p>Se rappeler qu'assigner une valeur retourne celle-ci</p>
								<pre><code>a=this.prop;if(a){...} // avant
if(a=this.prop){...}   // après</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h3>Boucles</h3>
						<ul>
							<li>
								<p><code>for</code> > <code>while</code></p>
								<pre><code>while(1);    // avant
for(;;);     // après

i=10;while(i--){...} // avant
for(i=10;i--;){...}  // après</code></pre>
							</li>
							<li>
								<p>Décrémenter si possible</p>
								<pre><code>for (i=0;i<10;i++) // avant
for (i=10;i--;)    // après</code></pre>
							</li>
							<li>
								<p>Placer certaines expressions dans le corps du <code>for</code></p>
								<pre><code>for(i=10;i--;){foo(); bar()}	// avant
for(i=10;i--;bar(),foo());	// après
for(i=10;i--;bar())foo();	        // encore après</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h3>Conditions</h3>
						<ul>
							<li>
								<p>En cas d'imbrications, penser aux ternaires</p>
								<pre><code>if(a){if(b)x=1; else x=2}else x=3;    // avant
x=a?b?1:2:3;                          // après</code></pre>
							</li>
							<li>
								<p>Tout simplement éviter les <code>if</code></p>
								<pre><code>if(a)foo()    // avant
a&&foo()      // après
 
if(!a)bar()   // avant
a||bar()      // après</code></pre>
							</li>
							<li>
								<p><code>^</code> pour tester l'inégalité de nombres</p>
								<pre><code>if(a!=123) // avant
if(a^123) // après</code></pre>
							</li>
							
							
						</ul>
					</section>
					
					<section>
						<h3>Divers</h3>
						<ul>
							<li>Connaître la précédence des opérateurs</li>
							<li>
								<p>Profiter de la coercition des arrays</p>
								<pre><code>"rgb("+(x+8)+","+(y-20)+","+z+")"; // avant
"rgb("+[x+8,y-20,z]+")";           // après</code></pre>
							</li>
							<li><i>Inliner</i> au maximum (éviter constantes et fonctions)</li>
							<li>...</li>
						</ul>
					</section>
				</section>
				
				<section>
					<section>
						<h2>Maths</h2>
					</section>
					
					<section>
						<h3>Nombres</h3>
						<ul>
							<li>
								<p>Arrondir / Tronquer sans utiliser <code>Math</code></p>
								<pre><code>truncA = Math.floor(a); // avant
truncA = 0|a; 	        // après

roundA = Math.round(a); // avant
roundA = a+.5|0; 	    // après</code></pre>
							</li>
							<li>
								<p>Réduire les grands nombres</p>
								<pre><code>million=1000000 // avant
million=1e6     // après

dix=10          // avant
dix=9           // après (ca paaaaasse!)</code></pre>
							</li>
						</ul>
					</section>
						
					<section>
						<h3>Génération procédurale</h3>
						<small>Rien n'égale la capacité d'expression et de synthèse des Maths ...</small>
						<ul>
							<li>Interpolation</li>
							<li>Géométrie 3D & Transformations</li>
							<li>Conditions par modulo</li>
							<li>...</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>Minifiers</h2>
					</section>
					
					<section>
						<h3>Google Closure</h3>
						<p>Suite compilant du JS afin de l'optimiser et le compacter.</p>
						<a href="http://closure-compiler.appspot.com"><img src="img/closure.jpg" alt="Closure" width=800 /></a>
					</section>
					
					<section>
						<h3>Traitement Post-Closure</h3>
						<ul>
							<li>
								<p>Supprimer les zéros inutiles</p>
								<pre><code>x=0.9 // avant
x=.9  // après</code></pre>
							</li>
							<li>
								<p>Supprimer le point-virgule final</p>
								<pre><code>foo();bar();voila(); // avant
foo();bar();voila()  // après</code></pre>
					</section>
					
					<section>
						<h3>JSCrush</h3>
						<p>Démo pour JS1K 2012 par <a href="https://twitter.com/aivopaas">@aivopaas</a></p>
						<p>Permet de compresser un code déjà minifié</p>
						<a href="http://www.iteral.com/jscrush"><img src="img/jscrush.jpg" alt="Closure" height=400; /></a>
					</section>
					
					<section>
						<h3>Comment JSCrush compresse:</h3>
							<ol>
								<li><p>Cherche le 1er char ASCII libre pour délimiter.</p>
									<p style="margin: 0 2em; font-size: .7em;">code = "<code>console.log('Hello-lo!')</code>" &rarr; delim = "<code>X</code>"</p>
								</li><li><p>Cherche les éléments répétitifs intéressants</p>
									<p style="margin: 0 2em; font-size: .7em;">code = "<code>console.log('Hello-lo!')</code>"&rarr; el = "<code>lo</code>" </p>
								</li><li><p><i>Split</i> le code en utilisant 2 puis <i>join</i> avec 1.</p>
									<p style="margin: 0 2em; font-size: .7em;">code = "<code>console.Xg('HelX-X!')</code>"</p>
								</li><li><p>Ajoute 1+2 au code, et 1 dans une autre chaîne.</p>
									<p style="margin: 0 2em; font-size: .7em;">code = "<code>console.Xg('HelX-X!')Xlo</code>", chaineDelim = "<code>X</code>"</p>
								</li><li><p>Répète jusqu'à plus de gain ou de délim.</p></li>
							</ol>
							
					</section>
					
					<section>
						<h3>Comment JSCrush décompresse:</h3>
							<p>Pour chaque caractère de la chaîne de délimiteurs:</p>
							<ol>
								<li>Le caractère est utilisé pour <i>split</i> le code.</li>
								<li>Le dernier morceau est <i>pop</i>-é et utilisé pour <i>join</i> à nouveau le code.</li>
							</ol>
							<pre><code>for(Y in $=chaineDelim)with(code.split($[Y]))code=join(pop());eval(code)</code></pre>
					</section>
					
					<section>
						<h3>Créer des <i>patterns</i> pour JSCrush</h3>
						<ul>
							<li>
								<p>Limiter et réutiliser les variables intelligemment</p>
								<small>ex: si vous utilisez toujours <code>A</code> pour les var. arrays, et <code>i</code> pour les indices, alors <code>A[i]</code> sera <i>crushé</i>, faisant gagner 3n-7 octets (n nombre d'apparition de <code>A[i]</code>)</small>
							</li>
							<li>
								<p>Réarranger les expressions</p>
								<pre><code>m=i*r-9;q=r*j-9 // avant
m=i*r-9;q=j*r-9 //après - pattern "*r-9;"</code></pre>
							</li>
							<li>
								<p>Uniformiser les signatures de fonctions</p>
								<pre><code>x=function(a){...}, y=function(b,c){...}   // avant
x=function(b,c){...}, y=function(b,c){...} // après</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h3>RegPack</h3>
						<p>Outil basé sur JSCrush, un peu plus efficace</a></p>
						<p>Ajoute une étape à la compression :<br/><code>chaineDelim</code> est convertie en une regex plus compacte.</p>
						<a href="https://github.com/Siorki/RegPack">http://github.com/Siorki/RegPack</a>
					</section>
				</section>

				<section>
					<section>
						<h1>Workflow</h1>
					</section>
					
					<section>
						<p>XXX TODO XXX</p>
					</section>
				</section>

				<section>
					<section>
						<h1>Gagnants</h1>
					</section>
					
					<section>
						<p>XXX TODO XXX</p>
					</section>
				</section>
				

				<section>
					<section>
						<h1>Bilan</h1>
					</section>
					
					<section>
						<p>XXX TODO XXX</p>
					</section>
				</section>

			</div>

		</div>

		<script src="../js/reveal.js-2.6.1/head.min.js"></script>
		<script src="../js/reveal.js-2.6.1/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: '../js/reveal.js-2.6.1/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '../js/reveal.js-2.6.1/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../js/reveal.js-2.6.1/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../js/reveal.js-2.6.1/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../js/reveal.js-2.6.1/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: '../js/reveal.js-2.6.1/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
